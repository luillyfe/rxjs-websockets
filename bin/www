#!/usr/bin/env node
const app = require("../app");
const http = require("http").Server(app);
const WebSocket = require("ws");
const wss = new WebSocket.Server({ server: http });

const port = process.env.PORT || 3200;

http.listen(port, () => {
    console.log(`Server started and listening on ${port} port`);
});

wss.on("connection", ws => {
    //connection is up, let's add a simple simple event
    ws.on("message", message => {
        //log the received message and send it back to the client
        const msg = JSON.parse(message);
        console.log(msg);
        ws.send(`{"msg": ${msg}}`);
    });

    //send immediatly a feedback to the incoming connection
    ws.send('{"message": "Conecction successfull!", "state": "ok"}');
});
